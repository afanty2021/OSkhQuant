# 成交量类技术指标

<cite>
**本文档引用文件**   
- [MyTT.py](file://MyTT.py)
- [khQuantImport.py](file://khQuantImport.py)
- [strategies/RSI策略.py](file://strategies/RSI策略.py)
- [strategies/双均线多股票_使用MA函数.py](file://strategies/双均线多股票_使用MA函数.py)
- [khQTTools.py](file://khQTTools.py)
</cite>

## 目录
1. [引言](#引言)
2. [核心成交量指标详解](#核心成交量指标详解)
3. [指标融合与多因子策略示例](#指标融合与多因子策略示例)
4. [结论](#结论)

## 引言

成交量是金融市场中衡量交易活跃度的核心指标，它与价格共同构成了市场行为的两大支柱。在技术分析中，成交量被视为价格变动的“燃料”，其变化往往能提前揭示市场情绪和主力资金的动向。本指南旨在深入解析`MyTT.py`库中提供的五种核心成交量类技术指标：`OBV`（能量潮）、`VR`（容量比率）、`MFI`（资金流量指标）、`EMV`（简易波动指标）和`ASI`（振动升降指标）。我们将详细阐述它们的计算原理、输入参数（特别是`VOL`成交量字段的使用）、输出值的解读方法，以及如何将这些成交量信号与价格信号结合，以提高交易决策的准确性。

**Section sources**
- [MyTT.py](file://MyTT.py#L1-L12)

## 核心成交量指标详解

本节将逐一剖析`MyTT.py`库中实现的五种成交量指标，揭示其背后的计算逻辑和市场含义。

### OBV (能量潮)

`OBV`（On-Balance Volume）指标通过将成交量与价格变动方向相结合，来衡量资金的净流入或流出，从而判断市场趋势的强度和可持续性。

**计算原理**:
`OBV`的计算遵循一个简单的规则：
1.  如果当日收盘价高于前一日收盘价，则将当日的成交量累加到`OBV`值上。
2.  如果当日收盘价低于前一日收盘价，则从`OBV`值中扣除当日的成交量。
3.  如果当日收盘价等于前一日收盘价，则`OBV`值保持不变。
4.  最终结果通常会除以一个常数（如10000）进行单位转换，使其数值更易于观察。

**输入参数**:
- `CLOSE`: 收盘价序列。
- `VOL`: 成交量序列（单位为“手”）。

**输出值解读**:
`OBV`指标的核心在于其与价格的“背离”现象。当价格创新高而`OBV`未能同步创新高时，称为“顶背离”，预示上涨动能减弱，可能出现反转。反之，当价格创新低而`OBV`未能同步创新低时，称为“底背离”，预示下跌动能衰竭，可能见底回升。`OBV`的持续上升通常确认了上涨趋势的健康性。

**Section sources**
- [MyTT.py](file://MyTT.py#L377-L380)

### VR (容量比率)

`VR`（Volume Ratio）指标通过比较上涨日与下跌日的成交量比率，来衡量市场多空双方的力量对比，判断市场是处于“量增价涨”的健康状态还是“量价背离”的危险状态。

**计算原理**:
`VR`的计算公式为：
`VR = (上涨日的成交量总和 / 下跌日的成交量总和) * 100`
其中，上涨日指当日收盘价高于前一日收盘价的交易日，下跌日则相反。该计算通常在一个固定的周期（如26日）内进行。

**输入参数**:
- `CLOSE`: 收盘价序列。
- `VOL`: 成交量序列（单位为“手”）。
- `M1`: 计算周期，默认为26。

**输出值解读**:
`VR`值的解读通常结合一个基准线（如100）：
- `VR > 100`：表明上涨日的成交量总和大于下跌日，市场多头力量占优。
- `VR < 100`：表明下跌日的成交量总和大于上涨日，市场空头力量占优。
- `VR`值过高（如超过400）可能意味着市场过热，有回调风险。
- `VR`值过低（如低于40）可能意味着市场交投清淡，有反弹可能。
`VR`指标常用于判断市场整体的活跃度和情绪。

**Section sources**
- [MyTT.py](file://MyTT.py#L305-L308)

### MFI (资金流量指标)

`MFI`（Money Flow Index）被称为“成交量的RSI”，它将价格和成交量结合起来，计算资金的流入和流出，以判断市场是否处于超买或超卖状态。

**计算原理**:
1.  计算典型价格 `TYP = (HIGH + LOW + CLOSE) / 3`。
2.  计算“资金流量” `MF = TYP * VOL`。
3.  在一个周期内（如14日），分别计算`TYP`上涨日的`MF`总和（正资金流量）和`TYP`下跌日的`MF`总和（负资金流量）。
4.  计算资金比率 `V1 = 正资金流量 / 负资金流量`。
5.  最后，`MFI = 100 - (100 / (1 + V1))`，将其映射到0-100的区间。

**输入参数**:
- `CLOSE`, `HIGH`, `LOW`: 收盘价、最高价、最低价序列。
- `VOL`: 成交量序列（单位为“手”）。
- `N`: 计算周期，默认为14。

**输出值解读**:
`MFI`的解读与`RSI`类似：
- `MFI > 80`：市场处于超买区，价格可能回调。
- `MFI < 20`：市场处于超卖区，价格可能反弹。
- `MFI`与价格的背离是强烈的反转信号。
`MFI`比`RSI`更可靠，因为它考虑了成交量因素，能更真实地反映市场资金的动向。

**Section sources**
- [MyTT.py](file://MyTT.py#L383-L388)

### EMV (简易波动指标)

`EMV`（Ease of Movement Value）指标旨在衡量价格变动的“效率”，即价格变动所需成交量的大小。它认为，用较小的成交量就能推动价格大幅变动，说明市场趋势强劲。

**计算原理**:
1.  计算“价幅变动比例” `MID`，反映当日价格重心的变动。
2.  计算“成交量比率” `VOLUME`，即N日平均成交量与当日成交量的比值。
3.  将`MID`、`VOLUME`和当日价幅 `(HIGH - LOW)` 结合，计算出`EMV`值。
4.  通常会对`EMV`进行一次移动平均（`MAEMV`）以平滑曲线。

**输入参数**:
- `HIGH`, `LOW`: 最高价、最低价序列。
- `VOL`: 成交量序列（单位为“手”）。
- `N`: 计算周期，默认为14。
- `M`: 移动平均周期，默认为9。

**输出值解读**:
- `EMV`值为正，表明市场处于上升趋势。
- `EMV`值为负，表明市场处于下降趋势。
- `EMV`值的绝对值越大，说明价格变动的“效率”越高，趋势越强劲。
- 当`EMV`由负转正并上穿`MAEMV`时，是买入信号；反之，是卖出信号。
`EMV`特别适用于识别“量小价升”的强势股。

**Section sources**
- [MyTT.py](file://MyTT.py#L317-L323)

### ASI (振动升降指标)

`ASI`（Accumulation Swing Index）指标由技术分析大师Welles Wilder发明，它综合了开盘价、最高价、最低价和收盘价，以及前一日的价格，来计算一个复杂的“振动值”，以判断价格的内在波动和趋势。

**计算原理**:
`ASI`的计算非常复杂，涉及多个步骤：
1.  计算四个差值 `AA`, `BB`, `CC`, `DD`，分别代表当前最高/低价与前日收盘/最低价的差距。
2.  根据`AA`, `BB`, `CC`的大小关系，选择不同的公式计算基准值`R`。
3.  计算综合价格变动值`X`。
4.  计算单日的振动值 `SI = 16 * X / R * MAX(AA, BB)`。
5.  `ASI`是`SI`在M1日内的累计和，`ASIT`是`ASI`的M2日移动平均。

**输入参数**:
- `OPEN`, `CLOSE`, `HIGH`, `LOW`: 开盘价、收盘价、最高价、最低价序列。
- `M1`: 累计周期，默认为26。
- `M2`: 移动平均周期，默认为10。

**输出值解读**:
`ASI`本身是一个累积值，其绝对值意义不大，主要通过其与`ASIT`的交叉和趋势来判断：
- `ASI`上穿`ASIT`是买入信号。
- `ASI`下穿`ASIT`是卖出信号。
- `ASI`的长期趋势与价格趋势一致，可用来确认趋势。
`ASI`是一个非常精细的指标，能有效过滤市场噪音。

**Section sources**
- [MyTT.py](file://MyTT.py#L391-L407)

## 指标融合与多因子策略示例

单一指标可能存在局限性，将多个成交量指标与价格指标结合，可以构建更稳健的多因子策略。

### 策略逻辑

一个典型的融合策略可以如下构建：
1.  **趋势确认**：使用`MA`（移动平均线）或`MACD`来判断市场的整体趋势。例如，当`CLOSE > MA(CLOSE, 20)`时，认为市场处于上升趋势。
2.  **动量与资金验证**：在上升趋势中，使用`MFI`或`VR`来验证上涨的健康性。例如，要求`MFI`处于50-80的健康区间，避免在超买区追高。
3.  **寻找买点**：当`OBV`出现底背离，或`EMV`由负转正并上穿其均线时，发出买入信号。
4.  **风险控制**：当`MFI`进入超买区（>80）或`VR`过高时，考虑减仓或止盈。

### 代码实现思路

在实际策略中，可以通过`khQuantImport`模块导入`MyTT`中的所有指标函数。使用`khHistory`函数获取历史数据，然后对每只股票分别计算所需的指标。

```python
from khQuantImport import *

def khHandlebar(data: Dict) -> List[Dict]:
    signals = []
    stock_list = khGet(data, "stocks")
    dn = khGet(data, "date_num")

    for sc in stock_list:
        # 获取历史数据
        hist = khHistory(sc, ["close", "high", "low", "open", "volume"], 60, "1d", dn, fq="pre")
        closes = hist[sc]["close"].values
        highs = hist[sc]["high"].values
        lows = hist[sc]["low"].values
        opens = hist[sc]["open"].values
        volumes = hist[sc]["volume"].values

        # 计算指标
        ma20 = MA(closes, 20)
        mfi = MFI(closes, highs, lows, volumes, 14)
        obv = OBV(closes, volumes)

        # 策略逻辑
        if (closes[-1] > ma20[-1]) and (50 < mfi[-1] < 80) and (obv[-1] > obv[-2]):
            # 发出买入信号
            pass

    return signals
```

**Section sources**
- [MyTT.py](file://MyTT.py#L377-L407)
- [khQuantImport.py](file://khQuantImport.py#L44-L45)
- [strategies/双均线多股票_使用MA函数.py](file://strategies/双均线多股票_使用MA函数.py#L14-L36)
- [khQTTools.py](file://khQTTools.py#L2482-L2679)

## 结论

成交量是解读市场行为的关键密码。`MyTT.py`库提供的`OBV`、`VR`、`MFI`、`EMV`和`ASI`等指标，从不同角度揭示了成交量与价格之间的内在联系。`OBV`和`VR`侧重于资金的净流入和多空对比，`MFI`和`EMV`则更关注资金流动的效率和健康度，而`ASI`则提供了一个综合性的波动视角。通过将这些成交量指标与传统的价格指标（如均线、MACD）相结合，可以构建出更加可靠和稳健的交易系统。在实际应用中，应结合市场环境，灵活运用这些工具，以提高交易决策的胜率。